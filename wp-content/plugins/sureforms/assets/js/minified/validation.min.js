function srfmSprintfString(e,...t){let s=0;return e.replace(/%(\d+\$)?s/g,(e,r)=>{r=r?parseInt(r)-1:s++;return void 0!==t[r]?t[r]:e})}async function getUniqueValidationData(r,e,t,s){let o="action=validation_ajax_action&nonce="+encodeURIComponent(s)+"&id="+encodeURIComponent(e);Object.keys(r).forEach(e=>{o+="&"+encodeURIComponent(e)+"="+encodeURIComponent(r[e])});try{var i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(i.ok)return(await i.json()).data}catch(e){console.error(e)}}async function fieldValidation(e,r,t,s,o=!1){let l=!1,i=null,n=null,a={};const c=(e,r,t={})=>{i||(i=e,n=r,a=t)};let m=null;var f=document.querySelectorAll('input[data-unique="true"]');if(0!==f.length){var u={};for(const E of f){var d=E.name,b=E.value;u[d]=b}m=await getUniqueValidationData(u,e,r,t)}for(const x of o?[s]:Array.from(s.querySelectorAll(".srfm-block-single"))){let r=!1;if(Array.isArray(window.sureforms?.skipValidationCallbacks)&&window.sureforms.skipValidationCallbacks.forEach(e=>{"function"==typeof e&&(r=r||e(x))}),!r){var p=x.closest("form").getAttribute("form-id");if(p===e){let e,r;r=!0===x.classList.contains("srfm-phone-block")?(e=x.querySelector(".srfm-input-phone"))?.nextElementSibling?.value:(e=x.querySelector("input, textarea, select")).value;var L,g,v,y,p=e.getAttribute("data-required"),k=e.getAttribute("data-unique");let t=e.getAttribute("name");const _=x.querySelector(".srfm-error-message");if(t=t&&t.replace(/_/g," "),p&&"hidden"!==e.type&&("true"!==p||r?e&&e.closest(".srfm-block").classList.remove("srfm-error"):(e&&e.closest(".srfm-block").classList.add("srfm-error"),_&&(_.textContent=_.getAttribute("data-error-msg")),l=!0,c(e,e.closest(".srfm-block"))),e.addEventListener("input",()=>{e.closest(".srfm-block").classList.remove("srfm-error")})),"true"===k&&""!==r&&(m?.some(e=>"not unique"===e[t])?(e&&e.closest(".srfm-block").classList.add("srfm-error"),_.style.display="block",_.textContent=_.getAttribute("data-unique-msg"),l=!0,c(e,e.closest(".srfm-block"))):e&&(e.closest(".srfm-block").classList.remove("srfm-error"),_.style.display="none")),x.classList.contains("srfm-multi-choice-block")||x.classList.contains("srfm-checkbox-block")||x.classList.contains("srfm-gdpr-block")){var S=x.querySelectorAll("input"),k=S[0].getAttribute("data-required");let r=!1,t=null;for(let e=0;e<S.length;e++)if(t||"hidden"===S[e].type||(t=S[e]),S[e].checked){r=!0;break}"true"!==k||r?_&&x.classList.remove("srfm-error"):(_&&(_.textContent=x.querySelector(".srfm-error-message").getAttribute("data-error-msg"),x.classList.add("srfm-error")),l=!0,c(t,x)),S.forEach(e=>{e.addEventListener("input",()=>{x.classList.remove("srfm-error")})})}if(x.classList.contains("srfm-url-block")&&(k=x.querySelector("input"),x.classList.contains("srfm-url-error")&&(x.classList.add("srfm-error"),l=!0,c(k,x)),k.addEventListener("input",()=>{x.classList.remove("srfm-error")})),x.classList.contains("srfm-phone-block")&&(k=x.querySelectorAll("input")[1],x.classList.contains("srfm-phone-error")&&(x.classList.add("srfm-error"),l=!0,c(k,x)),x.querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>{x.classList.remove("srfm-error")})})),x.classList.contains("srfm-password-block-wrap")&&(k=x)&&(k=k.querySelector(".srfm-password-confirm-block"))&&(g=k.querySelector(".srfm-input-password-confirm").value,L=k.querySelector(".srfm-error-message"),!g&&L&&"true"===p?(L.textContent=L.getAttribute("data-error-msg"),k.classList.add("srfm-error"),c(g,k),l=!0):g!==r?(k.classList.add("srfm-error"),L.textContent=window?.srfm_submit?.messages?.confirm_password_same,c(g,k),l=!0):k.classList.remove("srfm-error")),x.classList.contains("srfm-email-block-wrap")){const C=x;if(C){const I=C.querySelector(".srfm-email-confirm-block");C.classList.contains("srfm-valid-email-error")&&(c(e,C),l=!0),I&&(L=I.querySelector(".srfm-input-email-confirm"),g=I.querySelector(".srfm-input-email-confirm").value,k=I.querySelector(".srfm-error-message"),!g&&k&&"true"===p?(k.textContent=k.getAttribute("data-error-msg"),I.classList.add("srfm-error"),c(L,I),l=!0):g!==r?(I.classList.add("srfm-error"),k.textContent=window?.srfm_submit?.messages?.confirm_email_same,c(L,I),l=!0):I.classList.remove("srfm-error"),L.addEventListener("input",()=>{I.classList.remove("srfm-error")})),C.querySelector(".srfm-input-email").addEventListener("input",()=>{C.classList.remove("srfm-error")})}}if(x.classList.contains("srfm-upload-block")&&("true"!==(v=(k=x.querySelector(".srfm-input-upload")).getAttribute("data-required"))||k.value?e&&e.closest(".srfm-block").classList.remove("srfm-error"):("true"===v&&_&&(_.textContent=_.getAttribute("data-error-msg")),e&&e.closest(".srfm-block").classList.add("srfm-error"),l=!0,c(k,x)),k.addEventListener("input",()=>{e&&e.closest(".srfm-block").classList.remove("srfm-error")})),x.classList.contains("srfm-number-block")&&(v=e.getAttribute("min"),k=e.getAttribute("max"),y=e.getAttribute("format-type"),r)&&(y="eu-style"===y?parseFloat(r.replace(/\./g,"").replace(",",".")):parseFloat(r.replace(/,/g,"")),v&&(""!==v&&Number(y)<Number(v)?(e.closest(".srfm-block").classList.add("srfm-error"),_&&(_.textContent=srfmSprintfString(window?.srfm_submit?.messages?.input_min_value,v))):e.closest(".srfm-block").classList.remove("srfm-error")),k)&&(""!==k&&Number(y)>Number(k)?(e.closest(".srfm-block").classList.add("srfm-error"),_&&(_.textContent=srfmSprintfString(window?.srfm_submit?.messages?.input_max_value,k))):e.closest(".srfm-block").classList.remove("srfm-error")),x.classList.contains("srfm-rating-block")&&("true"!==(y=x.querySelector(".srfm-input-rating")).getAttribute("data-required")||y.value?y.closest(".srfm-block").classList.remove("srfm-error"):(y.closest(".srfm-block").classList.add("srfm-error"),l=!0,c(x.querySelector(".srfm-icon"),x))),x.classList.contains("srfm-slider-block")){var k=x.getAttribute("data-required"),w=x.querySelector(".srfm-input-slider"),q=x.querySelector(".srfm-text-slider"),h=x.getAttribute("data-default");if("true"===k){let e=!1;(e=(!w||w.dataset.interacted||h&&"false"!==h)&&(!q||q.dataset.interacted||h&&"false"!==h)?e:!0)?(x.classList.add("srfm-error"),l=!0,c(w,x)):x.classList.remove("srfm-error")}}if(x.classList.contains("srfm-dropdown-block")){k=x.querySelectorAll(".srfm-input-dropdown-hidden");const V=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;k.forEach(e=>{const r=e.getAttribute("data-required");var t,s,o,i=e.getAttribute("name");"true"!==r||e.value?e.value?(o=e.getAttribute("data-min-selection"),t=e.getAttribute("data-max-selection"),(o||t)&&(s=e.value.split(","),o&&s.length<o?(_.textContent=srfmSprintfString(window?.srfm_submit?.messages?.dropdown_min_selections,o),e.closest(".srfm-block").classList.add("srfm-error"),l=!0):t&&s.length>t&&(_.textContent=srfmSprintfString(window?.srfm_submit?.messages?.dropdown_max_selections,t),e.closest(".srfm-block").classList.add("srfm-error"),l=!0))):e.closest(".srfm-block").classList.remove("srfm-error"):(_.textContent=_.getAttribute("data-error-msg"),e.closest(".srfm-block").classList.add("srfm-error"),l=!0),l&&(o=window?.srfm?.[i]||e,c(o,e.closest(".srfm-block"),{shouldDelayOnFocus:!0})),new V(()=>{e.value?e.closest(".srfm-block").classList.remove("srfm-error"):"true"===r&&e.closest(".srfm-block").classList.add("srfm-error")}).observe(e,{attributes:!0,attributeFilter:["value"]})})}if(x.classList.contains("srfm-multi-choice-block")){var A=x.querySelectorAll("input"),q=A[0].getAttribute("data-min-selection"),h=A[0].getAttribute("data-max-selection");let r=null,t=0,e=!1;for(let e=0;e<A.length;e++)r||"hidden"===A[e].type||(r=A[e]),A[e].checked&&t++;(q||h)&&0<t&&(!e&&0<q&&(p&&1<q||!p)&&t<q&&(_.textContent=srfmSprintfString(window?.srfm_submit?.messages?.multi_choice_min_selections,q),e=!0),!e&&0<h&&t>h&&(_.textContent=srfmSprintfString(window?.srfm_submit?.messages?.multi_choice_max_selections,h),e=!0),e?(x.classList.add("srfm-error"),c(r,x),l=!0):p||x.classList.remove("srfm-error"))}}}}return!!l&&{validateResult:l,firstErrorInput:i,scrollElement:n,...a}}function initializeInlineFieldValidation(){["srfm-input-block","srfm-email-block-wrap","srfm-url-block","srfm-phone-block","srfm-checkbox-block","srfm-gdpr-block","srfm-number-block","srfm-multi-choice-block","srfm-datepicker-block","srfm-upload-block","srfm-rating-block","srfm-textarea-block","srfm-dropdown-block","srfm-slider-block"].forEach(e=>addBlurListener(e,"."+e))}function addBlurListener(r,t){var e=Array.from(document.getElementsByClassName(r));if(e)for(const s of e){let e=s.querySelector("input")||s.querySelector("textarea")||s.querySelector("select");if("srfm-upload-block"===r&&(e=s.querySelector('input[type="file"]')),"srfm-rating-block"===r&&addRatingBlurListener(e,s,t),"srfm-multi-choice-block"===r&&addMultiChoiceBlurListener(e,s,t),"srfm-email-block-wrap"===r&&addEmailBlurListener(s,t),"srfm-slider-block"===r&&addSliderBlurListener(e,s,t),"srfm-dropdown-block"===r){const o=e.getAttribute("name");setTimeout(()=>{window?.srfm?.[o]?.on("blur",function(){fieldValidationInit(e,t)})},500)}(e="srfm-phone-block"===r?s.querySelector(".srfm-input-phone"):e)&&e.addEventListener("blur",async function(){fieldValidationInit(e,t)})}}function addRatingBlurListener(t,e,s){(t=e.querySelectorAll(".srfm-icon")).forEach((e,r)=>{r===t.length-1&&e.addEventListener("blur",async function(){fieldValidationInit(e,s)})})}function addMultiChoiceBlurListener(e,r,t){r.querySelectorAll(".srfm-input-multi-choice-single").forEach(e=>{e.addEventListener("blur",async function(){fieldValidationInit(e,t)})})}function addEmailBlurListener(e,r){var t=e.querySelectorAll("input");const l=e.closest(r);t.forEach(i=>{i.addEventListener("input",async function(){i.value=i.value.trim().toLowerCase();let e=!1;/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(i.value)&&(e=!0);var r=i.classList.contains("srfm-input-email-confirm")?l.querySelector(".srfm-email-confirm-block"):l.querySelector(".srfm-email-block"),t=r.querySelector(".srfm-error-message");if(i.value||(t.style.display="none",r.classList.remove("srfm-valid-email-error")),i.classList.contains("srfm-input-email-confirm")){var s=l.querySelector(".srfm-input-email"),o=l.querySelector(".srfm-email-confirm-block").querySelector(".srfm-error-message");if(s.value!==i.value)return o.style.display="block",o.textContent=window?.srfm_submit?.messages?.confirm_email_same,void l.classList.add("srfm-error");l.classList.remove("srfm-error"),o.textContent="",o.style.display="none"}e?(t.style.display="none",r.parentElement.classList.remove("srfm-valid-email-error")):(r.parentElement.classList.add("srfm-valid-email-error"),t.style.display="block",t.innerHTML=window?.srfm_submit?.messages?.valid_email)})})}function addSliderBlurListener(e,r,t){const s=r.querySelector(".srfm-input-slider");r=r.querySelector(".srfm-text-slider");if(s&&s.addEventListener("blur",async function(){fieldValidationInit(s,t)}),r){const o=r.querySelector(".srfm-slider-thumb");o&&o.addEventListener("blur",async function(){fieldValidationInit(o,t)})}}const fieldValidationInit=async(e,r)=>{e=e.closest(r),r=e.closest("form");await fieldValidation(r.getAttribute("form-id"),r.getAttribute("ajaxurl"),r.getAttribute("nonce"),e,!0)},handleScrollAndFocusOnError=e=>{var r,t,s;e?.firstErrorInput&&(e?.scrollElement&&(r=e.scrollElement.getBoundingClientRect().top,t=window.pageYOffset,s=window.innerHeight,window.scroll({top:r+t-s/2,behavior:"smooth"})),e?.shouldDelayOnFocus?setTimeout(()=>{e.firstErrorInput.focus({preventScroll:!0})},500):e.firstErrorInput.focus({preventScroll:!0}))};export{fieldValidation,initializeInlineFieldValidation,handleScrollAndFocusOnError};